<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ÙØ¶Ø§Ø¡ Ø§Ù„ØªÙƒÙˆÙŠÙ† ØªÙˆÙ‚Ø±Øª - ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</title>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/html5-qrcode"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    /* ===========================
       1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© Ù„Ù„ØªØ¬Ø§ÙˆØ¨
       =========================== */
    * { 
        box-sizing: border-box; 
        -webkit-tap-highlight-color: transparent; /* Ø¥Ø²Ø§Ù„Ø© ÙˆÙ…ÙŠØ¶ Ø§Ù„Ù†Ù‚Ø± ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
    }

    body {
      font-family: 'Cairo', sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #e8fbf0, #dcf7e6);
      text-align: center;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      overflow-x: hidden;
      padding: 15px; /* Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø­ÙˆØ§Ù ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
    }

    /* ===========================
       2. Ø§Ù„Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù…ØªØ¬Ø§ÙˆØ¨Ø©)
       =========================== */
    .container {
      background: white;
      padding: 30px 25px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      text-align: center;
      width: 100%;
      max-width: 480px; /* Ø¹Ø±Ø¶ Ù…Ø«Ø§Ù„ÙŠ Ù„Ù„Ù‡ÙˆØ§ØªÙ ÙˆØ§Ù„ØªØ§Ø¨Ù„Øª */
      margin: 0 auto;
      position: relative;
      transition: all 0.3s ease;
    }

    /* ===========================
       3. Ø§Ù„Ù†ØµÙˆØµ ÙˆØ§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
       =========================== */
    .header-text {
        margin-bottom: 10px;
        border-bottom: 2px solid #f0f0f0;
        padding-bottom: 15px;
    }

    .header-text p {
        margin: 3px 0;
        font-size: 14px; /* Ø­Ø¬Ù… Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ */
        font-weight: 700;
        color: #444;
        line-height: 1.5;
    }

    .login-title {
        color: #0FBA50;
        margin-bottom: 15px;
        font-size: 20px;
        font-weight: 700;
        margin-top: 10px;
    }

    /* ===========================
       4. Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ­Ø±ÙƒØªÙ‡ (Ù…ØªØ¬Ø§ÙˆØ¨)
       =========================== */
    .login-logo-wrapper {
        position: relative;
        width: 130px;
        height: 130px;
        margin: 10px auto;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .login-logo {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #fff;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        position: relative;
        z-index: 2;
    }

    .login-logo-ring {
        position: absolute;
        width: 120px;
        height: 120px;
        border: 2px dashed #0FBA50;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        animation: rotateRing 15s linear infinite;
        z-index: 1;
    }

    @keyframes rotateRing {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }

    /* ===========================
       5. Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø±
       =========================== */
    input {
        width: 100%;
        padding: 14px;
        margin-bottom: 15px;
        border-radius: 12px;
        border: 2px solid #e0e0e0;
        font-size: 16px; /* ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªÙƒØ¨ÙŠØ± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø¢ÙŠÙÙˆÙ† */
        text-align: center;
        font-family: 'Cairo', sans-serif;
        transition: 0.3s;
        background: #fafafa;
    }

    input:focus {
        outline: none;
        border-color: #0FBA50;
        background: #fff;
        box-shadow: 0 0 0 4px rgba(15, 186, 80, 0.1);
    }

    button {
        background: #0FBA50;
        color: white;
        border: none;
        padding: 14px 0;
        border-radius: 12px;
        font-size: 16px;
        cursor: pointer;
        font-weight: 700;
        width: 100%;
        font-family: 'Cairo', sans-serif;
        transition: 0.3s;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    button:hover, button:active {
        background: #0a8a3a;
        transform: translateY(-1px);
    }

    .barcode-btn {
        background: #fff;
        color: #0FBA50;
        border: 2px solid #0FBA50;
    }

    .barcode-btn:hover, .barcode-btn:active {
        background: #0FBA50;
        color: white;
    }

    /* ØªÙ†Ø³ÙŠÙ‚ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù„ØªÙƒÙˆÙ† Ù…ØªØ¬Ø§ÙˆØ¨Ø© */
    #reader {
        width: 100% !important;
        max-width: 300px;
        margin: 15px auto;
        display: none;
        border-radius: 12px;
        overflow: hidden;
        border: 2px solid #0FBA50;
    }

    /* ===========================
       6. Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„
       =========================== */
    #imageLoaderOverlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.4); display: none;
        justify-content: center; align-items: center; z-index: 99999;
        backdrop-filter: blur(2px);
    }

    #loaderBox {
        background: #ffffff; padding: 25px 35px; border-radius: 16px;
        box-shadow: 0 8px 35px rgba(0,0,0,0.25); text-align: center;
        width: 85%; max-width: 300px;
    }

    .loader-circle {
        border: 5px solid #e6e6e6; border-top: 5px solid #0FBA50;
        border-radius: 50%; width: 50px; height: 50px; margin: auto;
        animation: spinLoader 0.9s linear infinite;
    }

    @keyframes spinLoader {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loader-text {
        margin-top: 15px; font-size: 16px; font-weight: 700;
        color: #0FBA50; font-family: 'Cairo', sans-serif;
    }

    .note-blink {
        animation: softBlink 1.6s infinite ease-in-out;
    }
    @keyframes softBlink {
        0% { opacity: 1; } 50% { opacity: 0.65; } 100% { opacity: 1; }
    }

    .swal2-popup {
        border-radius: 20px !important;
        font-family: 'Cairo', sans-serif !important;
    }
    
    .swal2-confirm {
        background: #0FBA50 !important;
        box-shadow: 0 4px 10px rgba(15, 186, 80, 0.3) !important;
        border-radius: 10px !important;
    }

    /* ===========================
       7. Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ÙˆØ³Ø§Ø¦Ø· (Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ø§Ù‹)
       =========================== */
    @media (max-width: 380px) {
        .container { padding: 20px 15px; }
        .header-text p { font-size: 12px; }
        .login-logo-wrapper { width: 100px; height: 100px; }
        .login-logo { width: 80px; height: 80px; }
        .login-logo-ring { width: 95px; height: 95px; }
        .login-title { font-size: 18px; }
        button, input { font-size: 14px; }
    }
  </style>
</head>

<body>
  <div class="container" id="mainContainer">
    
      <div class="header-text">
        <p>Ø§Ù„Ø¬Ù…Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ø§Ù„Ø¯ÙŠÙ…Ù‚Ø±Ø§Ø·ÙŠØ© Ø§Ù„Ø´Ø¹Ø¨ÙŠØ©</p>
        <p>ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ© Ø§Ù„ÙˆØ·Ù†ÙŠØ©</p>
        <p>Ù…Ø¯ÙŠØ±ÙŠØ© Ø§Ù„ØªØ±Ø¨ÙŠØ© Ù„ÙˆÙ„Ø§ÙŠØ© ØªÙˆÙ‚Ø±Øª</p>
        <p>Ù…ØµÙ„Ø­Ø© Ø§Ù„ØªÙƒÙˆÙ† ÙˆØ§Ù„ØªÙØªÙŠØ´</p>
      </div>
      
      <div class="login-logo-wrapper">
          <div class="login-logo-ring"></div>
          <img src="https://lh3.googleusercontent.com/d/1BqWoqh1T1lArUcwAGNF7cGnnN83niKVl" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù„Ø¬Ù†Ø©" class="login-logo">
      </div>

      <h2 class="login-title">ÙØ¶Ø§Ø¡ Ø§Ù„Ø±Ù‚Ù…ÙŠ Ù„Ù„ØªØªÙƒÙˆÙŠÙ† ØªÙˆÙ‚Ø±Øª</h2>
      
      <input type="text" id="empId" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ" oninput="validateNumber(this)">
      
      <button onclick="checkEmployee()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>

      <button type="button" class="barcode-btn" onclick="startBarcodeScanner()">
        <i class="fa-solid fa-camera"></i>
        Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
      </button>

      <div id="reader"></div>

      <input type="file" id="barcodeImage" accept="image/*" style="display:none; margin-top:8px;">
      
  </div>

<div id="imageLoaderOverlay">
    <div id="loaderBox">
        <div class="loader-circle"></div>
        <div class="loader-text">Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©â€¦</div>
    </div>
</div>

<script>
// ================= Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase =================
const firebaseConfig = {
  apiKey: "AIzaSyAkQz9pB2ZNlYIvdlTRvi4try3D8LLXS4g",
  authDomain: "databaseemploye.firebaseapp.com",
  projectId: "databaseemploye",
  storageBucket: "databaseemploye.firebasestorage.app",
  messagingSenderId: "408231477466",
  appId: "1:408231477466:web:e3bf5bd3eaca7cdcd3a5e3",
  measurementId: "G-DW8QJ5B231"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ğŸ”´ğŸ”´ Ø±Ø§Ø¨Ø· ØµÙØ­Ø© Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ ğŸ”´ğŸ”´
const DASHBOARD_PAGE = "dashboard_finale.html"; 

const REGEX_PATTERNS = {
  nonDigit: /\D/g
};

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø£Ø±Ù‚Ø§Ù… ÙÙ‚Ø·
function validateNumber(input) {
  input.value = input.value.replace(REGEX_PATTERNS.nonDigit, '');
  if (input.value.length > 16) input.value = input.value.slice(0, 16);
}

// ================= Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© =================
async function checkEmployee() {
  const empId = document.getElementById("empId").value.trim();

  // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø·ÙˆÙ„ (16 Ø±Ù‚Ù…)
  if (empId.length < 16) {
    Swal.fire({ 
      icon: 'warning', 
      title: 'Ø®Ø·Ø£', 
      text: 'Ø±Ù‚Ù… Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªÙƒÙˆÙ† Ù…Ù† 16 Ø±Ù‚Ù…Ù‹Ø§',
      confirmButtonText: 'Ø­Ø³Ù†Ø§Ù‹'
    });
    return;
  }

  // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
  Swal.fire({ title: 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });

  try {
    // 2. Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Firebase
    const docRef = db.collection("employeescom").doc(empId);
    const docSnap = await docRef.get();

    if (!docSnap.exists) {
      Swal.close();
      // Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø®Ø·Ø£ Ø§Ù„Ù…Ø®ØµØµØ© (Ø§Ø³ØªØ¨Ø¯Ø§Ù„ 1 Ø¨Ù€ 0)
      Swal.fire({
        icon: "error",
        title: "âŒ Ø®Ø·Ø£",
        html: `
          Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¸Ù ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.<br><br>
          <div class="note-blink" style="
            padding: 15px; background: linear-gradient(135deg, #ffe6e6 0%, #fff0f0 100%);
            color: #d00000; border: 2px solid #d00000; border-radius: 10px;
            box-shadow: 0 0 10px rgba(208, 0, 0, 0.2); font-weight: bold; font-size: 15px;
            text-align: center; line-height: 1.7;
          ">
            <span style="color:#d00000; font-size:16px;">Ù…Ù„Ø§Ø­Ø¸Ø© Ù…Ù‡Ù…Ø©:</span><br>
            Ø¥Ø°Ø§ ÙƒØ§Ù† Ø±Ù‚Ù…Ùƒ ØµØ­ÙŠØ­Ù‹Ø§ ÙˆÙŠÙ†ØªÙ‡ÙŠ Ø¨Ø§Ù„Ø±Ù‚Ù… <strong style="color:#b00000;">1</strong>ØŒ<br>
            Ø§Ø³ØªØ¨Ø¯Ù„Ù‡ Ø¨Ø§Ù„Ø±Ù‚Ù… <strong style="color:#b00000;">0</strong> ÙˆØ³ØªÙ†Ø¬Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.
          </div>
        `,
        confirmButtonText: "Ø­Ø³Ù†Ø§Ù‹"
      });
      return;
    }

    // 3. Ù†Ø¬Ø§Ø­ Ø§Ù„ØªØ­Ù‚Ù‚
    const data = docSnap.data();
    
    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯
    sessionStorage.setItem("userEmpId", empId);
    sessionStorage.setItem("userName", data.name || "Ø§Ù„Ù…ÙˆØ¸Ù");
    sessionStorage.setItem("isLoggedIn", "true");

    Swal.close();
    
    // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ Ø«Ù… Ø§Ù„ØªÙˆØ¬ÙŠÙ‡
    Swal.fire({
      icon: 'success',
      title: 'ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­',
      html: `Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ <b>${data.name || ''}</b><br>Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ...`,
      timer: 1500,
      timerProgressBar: true,
      showConfirmButton: false,
      willClose: () => {
        window.location.href = DASHBOARD_PAGE;
      }
    });

  } catch (err) {
    Swal.close();
    Swal.fire({
      icon: "error",
      title: "âŒ Ø®Ø·Ø£",
      text: "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª",
      confirmButtonText: "Ø­Ø³Ù†Ø§Ù‹"
    });
    console.error("Firebase error:", err);
  }
}

// ================= ÙƒÙˆØ¯ Ù…Ø§Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ (ÙƒØ§Ù…ÙŠØ±Ø§ + ØµÙˆØ±Ø©) =================
let scanner = null;

function startBarcodeScanner() {
    const readerDiv = document.getElementById("reader");
    const imageInput = document.getElementById("barcodeImage");

    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
    imageInput.style.display = "block";

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¥Ø·Ø§Ø±
    readerDiv.innerHTML = "";
    readerDiv.style.display = "block";

    // Ù…Ù†Ø¹ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø§Ø³Ø­ Ø¬Ø¯ÙŠØ¯ Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ¹Ù…Ù„
    if (scanner) return;

    scanner = new Html5Qrcode("reader");

    // ØªØ´ØºÙŠÙ„ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ©
    scanner.start(
        { facingMode: { exact: "environment" } },
        { fps: 12, qrbox: 250 },
        decodedText => {
            if (navigator.vibrate) navigator.vibrate(200);

            document.getElementById("empId").value = decodedText;

            scanner.stop().then(() => {
                scanner = null;
                readerDiv.style.display = "none";
                imageInput.style.display = "none";
            });

            // âœ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§
            checkEmployee();
        }
    ).catch(() => {
        // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø«Ù… Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ©
        Html5Qrcode.getCameras().then(cameras => {
            if (!cameras.length) {
                Swal.fire("Ø®Ø·Ø£", "Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒØ§Ù…ÙŠØ±Ø§Øª Ù…ØªØ§Ø­Ø©", "error");
                return;
            }

            const backCam = cameras.find(c =>
                c.label.toLowerCase().includes("back") ||
                c.label.toLowerCase().includes("rear")
            );

            const camToUse = backCam ? backCam.id : cameras[0].id;

            scanner.start(
                camToUse,
                { fps: 12, qrbox: 250 },
                decodedText => {
                    if (navigator.vibrate) navigator.vibrate(200);

                    document.getElementById("empId").value = decodedText;

                    scanner.stop().then(() => {
                        scanner = null;
                        readerDiv.style.display = "none";
                        imageInput.style.display = "none";
                    });

                    // âœ… ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©
                    checkEmployee();
                }
            );
        });
    });

    // ğŸ–¼ Ù…Ø³Ø­ Ø¨Ø§Ø±ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©
    imageInput.onchange = function (e) {
        let file = e.target.files[0];
        if (!file) return;

        // 1. Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„ÙˆØ¯Ø±
        document.getElementById("imageLoaderOverlay").style.display = "flex";

        readerDiv.innerHTML = "";

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ØµØ± Ù…Ø¤Ù‚Øª
        let hiddenDiv = document.createElement("div");
        hiddenDiv.id = "temp-file-scan";
        hiddenDiv.style.display = "none";
        document.body.appendChild(hiddenDiv);

        const fileScanner = new Html5Qrcode("temp-file-scan");

        fileScanner.scanFile(file, true)
            .then(decodedText => {
                // 2. Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ¯Ø± ÙÙˆØ±Ø§Ù‹
                document.getElementById("imageLoaderOverlay").style.display = "none";

                if (navigator.vibrate) navigator.vibrate(200);
                
                // Ù…Ù„Ø¡ Ø§Ù„Ø­Ù‚Ù„ Ø¨Ø§Ù„Ø±Ù‚Ù…
                document.getElementById("empId").value = decodedText;
                
                // ØªÙ†Ø¸ÙŠÙ Ø¢Ù…Ù†
                try { 
                    if (hiddenDiv.parentNode) hiddenDiv.parentNode.removeChild(hiddenDiv); 
                } catch(err) { console.log(err); }
                
                if (scanner) { 
                    scanner.stop().then(() => {
                        scanner = null;
                        readerDiv.style.display = "none";
                        imageInput.style.display = "none";
                        imageInput.value = ""; // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ù‚Ù„ Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø±ÙØ¹
                    }).catch(()=>{}); 
                } else {
                    readerDiv.style.display = "none";
                    imageInput.style.display = "none";
                    imageInput.value = "";
                }

                // âœ… 3. ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ø¨Ø³ÙŠØ· Ø¬Ø¯Ø§Ù‹
                setTimeout(() => {
                    checkEmployee();
                }, 100);

            })
            .catch((err) => {
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù„ÙˆØ¯Ø± Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„ ÙÙ‚Ø·
                document.getElementById("imageLoaderOverlay").style.display = "none";
                try { 
                    if (hiddenDiv.parentNode) hiddenDiv.parentNode.removeChild(hiddenDiv); 
                } catch(err) { console.log(err); }
                
                console.error("Scan Error:", err);
                
                Swal.fire({
                    icon: "warning",
                    title: "ØªÙ†Ø¨ÙŠÙ‡",
                    text: "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨Ø§Ø±ÙƒÙˆØ¯ ÙˆØ§Ø¶Ø­ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø©",
                    confirmButtonText: "Ø­Ø³Ù†Ø§Ù‹",
                    confirmButtonColor: "#0FBA50"
                }).then(() => {
                    imageInput.value = "";
                });
            });
    };
}

// ğŸ”’ ØªØ­ÙƒÙ… ÙÙŠ ÙØªØ­ ÙˆØºÙ„Ù‚ Ø§Ù„Ù…ÙˆÙ‚Ø¹
const registrationOpen = true; 

window.onload = function() {
    if (!registrationOpen) {
        document.getElementById("empId").style.display = "none";
        const buttons = document.querySelectorAll("button");
        buttons.forEach(btn => btn.style.display = "none");

        const msg = document.createElement("div");
        msg.innerHTML = `
        <div style="background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; border-radius: 10px; padding: 15px; margin-bottom: 20px; font-size: 18px; font-weight: 600;">
            Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…ØºÙ„Ù‚ Ø­Ø§Ù„ÙŠÙ‹Ø§<br>
        </div>`;
        document.querySelector(".header-text").appendChild(msg);
    }
};   

</script>
</body>
</html>



